%div
  %div.box
    %h3 Global Mini Proposal Information
    - form_for @data_request do |f|
      = render :partial => "data_request_attributes", :locals => {:f => f}
      = f.submit


  %div.box
    %h3 Collect and show Context
    - form_for @data_request do |f|
      - is_warning = false
      %div.scroll_checkboxes
        - for context in @contexts
          - dgdr = @data_request.data_request_contexts.find_by_context_id(context.id)
          - is_in = @current_cart.contexts.include?(context) ? true : false
          - if is_in && dgdr.nil?
            - is_warning = true
          = label_tag context.title
          = check_box_tag "contexts[]", context.id, ( is_in || !dgdr.nil?)
          = select "aspect", context.id, ["main", "side"], { :include_blank => true,
              :selected => dgdr.nil? ? false : dgdr.aspect }
          %br
      = f.submit :add
      - if is_warning
        = image_tag("/images/error.png", :title => "Warning")
        Warning! There are data columns from cart not added to this data proposal

  %div.box
    %h3 complete Author list

    %ul
      %li First Author
      %ul
        %li= @data_request.author.to_label
      %li Corresponding Author
      %ul
        %li= @data_request.corresponding.to_label
      %li Senior Author
      %ul
        %li= @data_request.senior_author.to_label
      %li Main Proponent (self selected)
      %ul
        - @data_request.author_data_requests.select{|join| join.kind == "user"}.each do |author_data_request|
          = author_data_request.person.to_label
      %li Potential Contributor (auto-generated)
      %ul
        - @data_request.author_data_requests.select{|join| join.kind == "main"}.each do |author_data_request|
          %li= author_data_request.person.to_label
      %li Acknowledgment
      %ul
        - @data_request.author_data_requests.select{|join| join.kind == "ack"}.each do |author_data_request|
          %li= author_data_request.person.to_label
      %li Complete author list
      = author_list_formatter(@data_request.author_list)

  = render :partial => 'additional_files'

  %div.box
    %h3 State of Data Request
    %p
      = render :partial => 'state_of_vote'
