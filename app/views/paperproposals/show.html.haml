= content_for :actions do
  %ul
    - if !@paperproposal.lock || current_user.has_role?(:admin || :data_admin)
      %li
        = link_to edit_paperproposal_path(@paperproposal) do
          = image_tag("edit.png")
          Edit Metadata
      %li
        = link_to edit_datasets_paperproposal_path(@paperproposal) do
          = image_tag("edit.png")
          Manage Datasets
      %li
        = link_to edit_files_paperproposal_path(@paperproposal) do
          = image_tag("edit.png")
          Manage Files
    - else
      %li
        = image_tag("lock-closed.png")
        Locked
    - if current_user.has_role?(:admin) && !@paperproposal.paperproposal_votes.blank?
      %li
        = link_to administrate_votes_paperproposal_path(@paperproposal) do
          = image_tag("edit.png")
          Administrate Votes

= content_for :info do
  %h3 State
  %p= @paperproposal.state
  %h3 Author
  = render @paperproposal.author
  - unless @paperproposal.proponents.empty?
    %h3 Main Proponents
    %ul
      - @paperproposal.proponents.each do |u|
        %li= render u
  - unless @paperproposal.authored_by_project.blank?
    %h3 Project
    = link_to @paperproposal.authored_by_project.name, @paperproposal.authored_by_project
  - if current_user
    %h3 Email lists
    %ul
      %li
        = render :partial => "users/email_list_modal",
                  :locals => {:list => User.email_list(@paperproposal.authors_selection(:author_and_proponents)),
                  :css => "paperproposal_owners_prop", :caption => 'Author and proponents'}
      %li
        = render :partial => "users/email_list_modal",
                  :locals => {:list => User.email_list(@paperproposal.authors_selection(:proponents_and_main)),
                  :css => "paperproposal_owners_main", :caption => 'Author, proponents and owners of main datasets'}
      %li
        = render :partial => "users/email_list_modal",
                  :locals => {:list => User.email_list(@paperproposal.authors_selection(:proponents_and_all_owners)),
                  :css => "paperproposal_owners_datasets", :caption => 'Author, proponents and all dataset owners'}
      %li
        = render :partial => "users/email_list_modal",
                  :locals => {:list => User.email_list(@paperproposal.authors_selection(:all_mentioned)),
                  :css => "paperproposal_authors_also_helper", :caption => 'Author, proponents, dataset owners and data helpers'}

%h2
  = @paperproposal.title

%p
  %strong Created at:
  = @paperproposal.created_at.to_date

- unless @paperproposal.initial_title == @paperproposal.title
  %p
    %strong Initial title:
    = @paperproposal.initial_title

- unless @paperproposal.envisaged_journal.blank?
  %p
    %strong Envisaged journal:
    =@paperproposal.envisaged_journal

- unless @paperproposal.envisaged_date.blank?
  %p
    %strong Envisaged date:
    =@paperproposal.envisaged_date

%h3 Rationale
%p= @paperproposal.rationale

%h3 Datasets #{"(" + @paperproposal.dataset_paperproposals.count.to_s + ")" unless @paperproposal.dataset_paperproposals.empty? }
- if !@paperproposal.dataset_paperproposals.empty?
  %ul
    - @paperproposal.dataset_paperproposals.includes(:dataset).each do |ds_pp|
      %li
        = link_to ds_pp.dataset.title, ds_pp.dataset
        = ds_pp.aspect
- else
  %p No datasets are linked to this paperproposal.

%h3 Calculated Authors
%p
  %span.comma-separated-list
    - @paperproposal.all_authors_ordered.each do |u|
      %span= link_to u.to_label, user_path(u.path_name)

- unless @freeformats.blank?
  %h3 Files (#{@freeformats.length})
  = render :partial => 'freeformats/index'

%h3 State of vote (???))
= render :partial => "state_of_vote"

