#dataset-import
  %h3
    Importing Data
  %p
    = image_tag 'ajax-loader.gif'
  %p#import-status
    = @dataset.import_status
  %noscript
    %p
      Javascript is disabled - Reload the page to see updates.

:javascript
  var statusElement = $("#import-status");
  var hideAfterFinishElement = $("#dataset-import")
  var showAfterFinishElement = $("#dataset-menu")
  var intervalTime = 5000;

  $.ajaxSetup({
    url: "#{importing_dataset_url @dataset.id}",
    dataType: "text",
    contentType: "text/plain",
    success: function(data) {
      updateStatus(data);
    }
  });

  var intervalId = setInterval(function() {
    $.ajax({
      error: function() {
        statusElement.text("Retrieving import status failed.");
        clearInterval(intervalId)
      }
    });
  }, intervalTime);

  function updateStatus(data) {
    statusElement.text(data);
    if(data == "finished") {
      clearInterval(intervalId);
      statusElement.text("YEAH YEAH YEAH");
      hideAfterFinishElement.addClass('hidden')
      showAfterFinishElement.removeClass('hidden');
    }
    if(data.indexOf('error') == 0) {  //String starts with 'error'
      // TODO
    }
  }